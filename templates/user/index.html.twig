{% extends 'base.html.twig' %}

{% block title %}Users{% endblock %}

{% block stylesheets %}
<style>
    :root {
        --primary-color: #3CCFCF;
        --secondary-color: #2EBBBB;
        --accent-color: #4cc417; /* Green for add button */
        --light-gray: #f8f9fa;
    }
    
    .page-header {
        margin-bottom: 2rem;
    }
    
    .users-table {
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(0,0,0,0.05);
    }
    
    .users-table thead {
        background: linear-gradient(135deg, #3CCFCF, #2EBBBB);
        color: white;
    }
    
    .users-table th {
        font-weight: 500;
        padding: 15px;
        border: none;
    }
    
    .users-table td {
        padding: 15px;
        vertical-align: middle;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .users-table tr:hover {
        background-color: rgba(60, 207, 207, 0.05);
    }
    
    .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #3CCFCF;
        color: white;
        font-weight: 500;
        font-size: 16px;
    }
    
    .badge {
        padding: 6px 10px;
        font-weight: 500;
        font-size: 12px;
        border-radius: 6px;
    }
    
    .badge-admin {
        background-color: #FF8C00; /* Orange */
        color: white;
    }
    
    .badge-coach {
        background-color: #3CCFCF;
        color: white;
    }
    
    .badge-user {
        background-color: #6c757d;
        color: white;
    }
    
    .badge-active {
        background-color: #4cc417; /* Green */
        color: white;
    }
    
    .badge-inactive {
        background-color: #9ca3af;
        color: white;
    }
    
    .btn-view {
        background-color: #f8f9fa;
        color: #333;
        border: 1px solid #e9ecef;
        transition: all 0.2s ease;
    }
    
    .btn-view:hover {
        background-color: #e9ecef;
        border-color: #dee2e6;
    }
    
    .btn-edit {
        background-color: rgba(60, 207, 207, 0.1);
        color: #3CCFCF;
        border: 1px solid rgba(60, 207, 207, 0.2);
        transition: all 0.2s ease;
    }
    
    .btn-edit:hover {
        background-color: rgba(60, 207, 207, 0.2);
        color: #2EBBBB;
    }
    
    .btn-delete {
        background-color: rgba(220, 53, 69, 0.1);
        color: #dc3545;
        border: 1px solid rgba(220, 53, 69, 0.2);
        transition: all 0.2s ease;
    }
    
    .btn-delete:hover {
        background-color: rgba(220, 53, 69, 0.2);
        color: #c82333;
    }
    
    .btn-new {
        background: linear-gradient(135deg, #5ed13f, #4cc417); /* Green gradient */
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    
    .btn-new:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(76, 196, 23, 0.3);
    }
    
    .search-form {
        width: 100%;
        max-width: 350px;
    }
    
    .search-input {
        border-radius: 20px;
        padding: 10px 15px;
        border: 1px solid #e9ecef;
        transition: all 0.3s;
    }
    
    .search-input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(60, 207, 207, 0.25);
    }
    
    .filters-bar {
        background: white;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        margin-bottom: 25px;
    }
    
    .form-select {
        border-radius: 8px;
        padding: 10px 15px;
        border: 1px solid #e9ecef;
        color: #495057;
        font-size: 14px;
    }
    
    .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(60, 207, 207, 0.25);
    }
    
    .stats-card {
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        padding: 20px;
        text-align: center;
        background: white;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }
    
    .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    
    .stats-card i {
        font-size: 35px;
        margin-bottom: 15px;
        color: #3CCFCF;
    }
    
    .stats-card h3 {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 5px;
    }
    
    .stats-card p {
        color: #6c757d;
        margin-bottom: 0;
    }
    
    .card-border-1 {
        border-top: 4px solid #3CCFCF;
    }
    
    .card-border-2 {
        border-top: 4px solid #FF8C00;
    }
    
    .card-border-3 {
        border-top: 4px solid #4cc417;
    }
    
    .card-border-4 {
        border-top: 4px solid #9ca3af;
    }
    
    /* No results message styling */
    .no-results {
        padding: 3rem;
        text-align: center;
        background-color: rgba(60, 207, 207, 0.05);
        border-radius: 10px;
    }
    
    .no-results i {
        font-size: 3rem;
        color: #9ca3af;
        margin-bottom: 1rem;
    }
    
    .no-results h3 {
        font-size: 1.5rem;
        color: #4b5563;
        margin-bottom: 0.5rem;
    }
    
    .no-results p {
        color: #6b7280;
        margin-bottom: 1.5rem;
    }
</style>
{% endblock %}

{% block body %}
<div class="container-fluid py-4">
    <div class="page-header mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="mb-0">Users</h2>
                <p class="text-muted">Manage user accounts and permissions</p>
            </div>
            <div>
                <a href="{{ path('app_user_new') }}" class="btn btn-new">
                    <i class="fas fa-plus me-2"></i>Create New
                </a>
            </div>
        </div>
    </div>

    <!-- Stats Row -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3 mb-md-0">
            <div class="stats-card card-border-1">
                <i class="fas fa-users"></i>
                <h3>{{ users|length }}</h3>
                <p>Total Users</p>
            </div>
        </div>
        <div class="col-md-3 mb-3 mb-md-0">
            <div class="stats-card card-border-2">
                <i class="fas fa-user-shield"></i>
                <h3>{{ users|filter(u => 'ROLE_ADMIN' in u.roles)|length }}</h3>
                <p>Administrators</p>
            </div>
        </div>
        <div class="col-md-3 mb-3 mb-md-0">
            <div class="stats-card card-border-3">
                <i class="fas fa-user-check"></i>
                <h3>{{ users|filter(u => u.isactive)|length }}</h3>
                <p>Active Users</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card card-border-4">
                <i class="fas fa-user-clock"></i>
                <h3>{{ users|filter(u => not u.isactive)|length }}</h3>
                <p>Inactive Users</p>
            </div>
        </div>
    </div>

    <!-- Filters Bar -->
    <div class="filters-bar mb-4">
        <div class="row align-items-center">
            <div class="col-md-6 mb-3 mb-md-0">
                <div class="input-group">
                    <span class="input-group-text bg-light">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" id="userSearch" class="form-control" placeholder="Search users...">
                </div>
            </div>
            <div class="col-md-6 d-flex justify-content-md-end">
                <select class="form-select me-2" style="max-width: 150px;" id="roleFilter">
                    <option value="">All Roles</option>
                    <option value="ROLE_ADMIN">Admin</option>
                    <option value="ROLE_USER">User</option>
                </select>
                <select class="form-select" style="max-width: 150px;" id="statusFilter">
                    <option value="">All Status</option>
                    <option value="1">Active</option>
                    <option value="0">Inactive</option>
                </select>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table users-table mb-0" id="usersTable">
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th class="text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for user in users %}
                        <tr>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="user-avatar me-3">
                                        {{ user.firstname|first|upper }}{{ user.lastname|first|upper }}
                                    </div>
                                    <div>
                                        <p class="mb-0 fw-medium">{{ user.firstname }} {{ user.lastname }}</p>
                                        <small class="text-muted">ID: {{ user.id }}</small>
                                    </div>
                                </div>
                            </td>
                            <td>{{ user.email }}</td>
                            <td>{{ user.phonenumber }}</td>
                            <td data-role="{{ user.role }}">
                                {% if user.role == 'ROLE_ADMIN' %}
                                    <span class="badge badge-admin">Admin</span>
                                {% elseif user.role == 'ROLE_COACH' %}
                                    <span class="badge badge-coach">Coach</span>
                                {% else %}
                                    <span class="badge badge-user">User</span>
                                {% endif %}
                            </td>
                            <td data-status="{{ user.isactive ? 1 : 0 }}">
                                {% if user.isactive %}
                                    <span class="badge badge-active">Active</span>
                                {% else %}
                                    <span class="badge badge-inactive">Inactive</span>
                                {% endif %}
                            </td>
                            <td class="text-end">
                                <div class="btn-group btn-group-sm">
                                    <a href="{{ path('app_user_show', {'id': user.id}) }}" class="btn btn-view">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{{ path('app_user_edit', {'id': user.id}) }}" class="btn btn-edit">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    {{ include('user/_delete_form.html.twig', {'button_class': 'btn btn-delete', 'button_icon': '<i class="fas fa-trash"></i>'}) }}
                                </div>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="6" class="text-center py-5">
                                <p class="text-muted mb-0">No users found</p>
                                <a href="{{ path('app_user_new') }}" class="btn btn-new mt-3">
                                    <i class="fas fa-plus me-2"></i>Create New User
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- No Results Message (Hidden by default) -->
            <div id="noResultsMessage" class="no-results" style="display: none;">
                <i class="fas fa-search"></i>
                <h3>No users found</h3>
                <p>Try adjusting your search or filter criteria</p>
                <button id="resetFilters" class="btn btn-outline-secondary">
                    <i class="fas fa-undo me-2"></i>Reset Filters
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Search and filter functionality
        const searchInput = document.getElementById('userSearch');
        const roleFilter = document.getElementById('roleFilter');
        const statusFilter = document.getElementById('statusFilter');
        const table = document.getElementById('usersTable');
        const rows = table.querySelectorAll('tbody tr');
        const noResultsMessage = document.getElementById('noResultsMessage');
        const resetFiltersBtn = document.getElementById('resetFilters');
        
        function filterTable() {
            const searchTerm = searchInput.value.toLowerCase();
            const roleValue = roleFilter.value;
            const statusValue = statusFilter.value;
            
            let visibleRows = 0;
            
            rows.forEach(row => {
                const rowData = row.textContent.toLowerCase();
                const roleData = row.querySelector('td[data-role]') ? 
                    row.querySelector('td[data-role]').getAttribute('data-role') : '';
                const statusData = row.querySelector('td[data-status]') ? 
                    row.querySelector('td[data-status]').getAttribute('data-status') : '';
                
                const matchesSearch = rowData.includes(searchTerm);
                const matchesRole = roleValue === '' || roleData === roleValue;
                const matchesStatus = statusValue === '' || statusData === statusValue;
                
                if (matchesSearch && matchesRole && matchesStatus) {
                    row.style.display = '';
                    visibleRows++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Show no results message if no matching rows
            if (visibleRows === 0 && rows.length > 0) {
                table.style.display = 'none';
                noResultsMessage.style.display = 'block';
            } else {
                table.style.display = '';
                noResultsMessage.style.display = 'none';
            }
        }
        
        function resetFilters() {
            searchInput.value = '';
            roleFilter.value = '';
            statusFilter.value = '';
            filterTable();
        }
        
        if (searchInput && roleFilter && statusFilter) {
            searchInput.addEventListener('keyup', filterTable);
            roleFilter.addEventListener('change', filterTable);
            statusFilter.addEventListener('change', filterTable);
            
            if (resetFiltersBtn) {
                resetFiltersBtn.addEventListener('click', resetFilters);
            }
        }
        
        // Initialize tooltips for action buttons
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>
{% endblock %}
